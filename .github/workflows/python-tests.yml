name: MVP Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ –æ—Ç–¥–µ–ª—å–Ω–æ
  test-block-a:
    name: "–ë–ª–æ–∫ A: –ü–∞—Ä—Ç–Ω–µ—Ä—ã + –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è"
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
        pip install pytest pytest-cov
    
    - name: Run Block A tests
      run: |
        echo "üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–ª–æ–∫–∞ A: –ë–∞–∑–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤"
        python -m pytest tests/ -k "A" -v --tb=short || echo "–¢–µ—Å—Ç—ã –±–ª–æ–∫–∞ A –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
    
    - name: Upload results
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: test-results-block-a
        path: |
          test-results/
        retention-days: 7

  test-block-b:
    name: "–ë–ª–æ–∫ B: –ë–æ—Ç + AI"
    runs-on: ubuntu-latest
    needs: test-block-a
    
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
        pip install pytest
    
    - name: Run Block B tests
      run: |
        echo "ü§ñ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–ª–æ–∫–∞ B: –ë–æ—Ç-–ø—Ä–æ–≤–æ–¥–Ω–∏–∫"
        python -m pytest tests/ -k "B" -v --tb=short || echo "–¢–µ—Å—Ç—ã –±–ª–æ–∫–∞ B –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"

  test-block-c:
    name: "–ë–ª–æ–∫ C: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏"
    runs-on: ubuntu-latest
    needs: test-block-b
    
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
        pip install pytest
    
    - name: Run Block C tests
      run: |
        echo "üîó –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–ª–æ–∫–∞ C: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏"
        python -m pytest tests/ -k "C" -v --tb=short || echo "–¢–µ—Å—Ç—ã –±–ª–æ–∫–∞ C –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"

  test-block-d:
    name: "–ë–ª–æ–∫ D: –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è"
    runs-on: ubuntu-latest
    needs: test-block-c
    
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
        pip install pytest pytest-cov
    
    - name: Run Block D tests
      run: |
        echo "üí∞ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–ª–æ–∫–∞ D: –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è"
        python -m pytest tests/ -k "D" -v --tb=short || echo "–¢–µ—Å—Ç—ã –±–ª–æ–∫–∞ D –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
    
    - name: Coverage report
      run: |
        python -m pytest tests/ --cov=backend --cov-report=xml

  # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
  integration-tests:
    name: "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã"
    runs-on: ubuntu-latest
    needs: [test-block-a, test-block-b, test-block-c, test-block-d]
    
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
        pip install pytest
    
    - name: Run integration tests
      run: |
        echo "üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã"
        python -m pytest tests/test_integration.py -v --tb=short || echo "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"

  # –°–±–æ—Ä–∫–∞ –∏ –¥–µ–ø–ª–æ–π
  deploy:
    name: "–î–µ–ø–ª–æ–π"
    runs-on: ubuntu-latest
    needs: integration-tests
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: Deploy notification
      run: |
        echo "‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã!"
        echo "üì¶ –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é"
        echo "üöÄ –í–µ—Ä—Å–∏—è: ${{ github.sha }}"
    
 
   
